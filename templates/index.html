<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Annotation</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: lightblue;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="mt-5 mb-4">Stride Matching</h1>
        <div class="mb-3">
            <label for="match_id" class="form-label">Match ID:</label>
            <input type="text" class="form-control" id="match_id" placeholder="Enter Match ID">
            <select class="form-select mt-3" id="available_match_ids">
                <option selected>Select from available Match IDs</option>
                {% for match_id in match_ids %}
                    <option value="{{ match_id }}">{{ match_id }}</option>
                {% endfor %}
            </select>
        </div>
        <h2 class="mt-5">Table A</h2>
        <table class="table table-striped" id="table_a">
        </table>
        <h2 class="mt-5">Table B</h2>
        <table class="table table-striped" id="table_b">
        </table>
    </div>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        function fetch_data(match_id) {
            $.getJSON("/data/" + match_id, function(data) {
                // Populate Table A
                $("#table_a").html("");
                let table_a_header = "";
                for (let key in data.table_a[0]) {
                    console.log(key)
                    table_a_header += "<th scope='col'>" + key + "</th>";
                }
                table_a_header += "</tr></thead>";
                $("#table_a").append(table_a_header);

                let table_a_body = "<tbody>";
               
                for (let key in data.table_a[0]) {
                    table_a_body += "<td>" + data.table_a[0][key] + "</td>";
                }
                table_a_body += "</tr>";
                
                table_a_body += "</tbody>";
                $("#table_a").append(table_a_body);

                // Populate Table B
                $("#table_b").html("");
                let table_b_header = "<thead><tr><th scope='col'>Select if match</th>";
                for (let key in data.table_b[0]) {
                    table_b_header += "<th scope='col'>" + key + "</th>";
                }
                table_b_header += "</tr></thead>";
                $("#table_b").append(table_b_header);

                let table_b_body = "<tbody>";
                for (let i = 0; i < data.table_b.length; i++) {
                    table_b_body += "<tr><td><input type='checkbox' class='checkbox' data-id='" + data.table_b[i].id + "' " + (data.table_b[i].match ? "checked" : "") + "></td>";
                    for (let key in data.table_b[i]) {
                        table_b_body += "<td>" + data.table_b[i][key] + "</td>";
                    }
                    table_b_body += "</tr>";
                }
                table_b_body += "</tbody>";
                $("#table_b").append(table_b_body);
            });
        }

        $("#match_id, #available_match_ids").on("change input", function() {
            fetch_data($(this).val());
});
    $(document).on("change", ".checkbox", function() {
        let id = $(this).data("id");
        let checked = $(this).is(":checked");
        $.post("/update_match", {id: id, match: checked ? 1 : 0});
    });
</script>
</body>
</html>
